{"version":3,"file":"CustomTabBar.js","sources":["components/CustomTabBar.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTovcGVyc29uYWwvd3gvdW5pLXVpL2NvbXBvbmVudHMvQ3VzdG9tVGFiQmFyLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"custom-tab-bar\">\r\n    <view class=\"tab-bar-border\"></view>\r\n    <view class=\"tab-bar-content\">\r\n      <view \r\n        v-for=\"(tab, index) in tabList\" \r\n        :key=\"index\"\r\n        class=\"tab-item\"\r\n        :class=\"{ active: currentIndex === index }\"\r\n        @click=\"switchTab(tab, index)\"\r\n      >\r\n        <view class=\"tab-icon\">\r\n          <uni-icons \r\n            :type=\"tab.iconType\" \r\n            :size=\"24\" \r\n            :color=\"currentIndex === index ? activeColor : inactiveColor\" \r\n          />\r\n        </view>\r\n        <text \r\n          class=\"tab-text\" \r\n          :style=\"{ color: currentIndex === index ? activeColor : inactiveColor }\"\r\n        >\r\n          {{ tab.text }}\r\n        </text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { LoginStateManager, RouteGuard } from '@/utils/auth.js'\r\n\r\n// 定义props\r\nconst props = defineProps({\r\n  current: {\r\n    type: Number,\r\n    default: 0\r\n  }\r\n})\r\n\r\n// 定义emit\r\nconst emit = defineEmits(['change'])\r\n\r\n// 响应式数据\r\nconst currentIndex = ref(props.current)\r\nconst activeColor = '#007AFF'\r\nconst inactiveColor = '#999999'\r\n\r\n// 底部导航配置\r\nconst tabList = [\r\n  {\r\n    pagePath: '/pages/index/index',\r\n    iconType: 'home',\r\n    text: '首页'\r\n  },\r\n  {\r\n    pagePath: '/pages/study/study',\r\n    iconType: 'medal',\r\n    text: '学习'\r\n  },\r\n  {\r\n    pagePath: '/pages/question/question',\r\n    iconType: 'help',\r\n    text: '题库'\r\n  },\r\n  {\r\n    pagePath: '/pages/profile/profile',\r\n    iconType: 'person',\r\n    text: '我的'\r\n  }\r\n]\r\n\r\n// 切换tab\r\nconst switchTab = (tab, index) => {\r\n  if (currentIndex.value === index) return\r\n  \r\n  // 检查页面访问权限\r\n  if (RouteGuard.isProtectedRoute(tab.pagePath)) {\r\n    const isLoggedIn = LoginStateManager.getLoginState()\r\n    \r\n    if (!isLoggedIn) {\r\n      console.log('❌ Tab切换需要登录权限:', tab.pagePath)\r\n      \r\n      // 保存目标路径，用于登录成功后跳转\r\n      RouteGuard.saveReturnPath(tab.pagePath)\r\n      \r\n      // 显示登录提示\r\n      uni.showModal({\r\n        title: '需要登录',\r\n        content: '访问此页面需要登录，是否立即登录？',\r\n        confirmText: '立即登录',\r\n        cancelText: '稍后再说',\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            // 跳转到登录页面\r\n            uni.navigateTo({\r\n              url: '/pages/login/login'\r\n            })\r\n          }\r\n          // 注意：无论用户选择什么，都不改变当前tab状态\r\n        }\r\n      })\r\n      \r\n      // 权限检查失败，不切换tab状态\r\n      return\r\n    }\r\n  }\r\n  \r\n  // 权限检查通过，切换tab状态\r\n  currentIndex.value = index\r\n  emit('change', index)\r\n  \r\n  // 执行页面跳转\r\n  uni.switchTab({\r\n    url: tab.pagePath,\r\n    fail: () => {\r\n      // 如果switchTab失败，使用redirectTo\r\n      uni.redirectTo({\r\n        url: tab.pagePath,\r\n        fail: () => {\r\n          // 如果页面跳转彻底失败，恢复原来的tab状态\r\n          console.error('❌ 页面跳转失败，恢复tab状态')\r\n          // 这里需要恢复到之前的状态，但由于我们无法确定之前的状态\r\n          // 可以通过emit通知父组件处理，或者重新计算当前页面对应的tab\r\n          \r\n          // 简单的处理方式：显示错误提示\r\n          uni.showToast({\r\n            title: '页面跳转失败',\r\n            icon: 'error'\r\n          })\r\n        }\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n// 监听页面变化\r\nonMounted(() => {\r\n  currentIndex.value = props.current\r\n})\r\n\r\n// 暴露方法给父组件\r\ndefineExpose({\r\n  setCurrentIndex: (index) => {\r\n    currentIndex.value = index\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.custom-tab-bar {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  z-index: 9999;\r\n  background: #ffffff;\r\n  box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.tab-bar-border {\r\n  height: 1rpx;\r\n  background: #e5e5e5;\r\n}\r\n\r\n.tab-bar-content {\r\n  display: flex;\r\n  height: 100rpx;\r\n  padding-bottom: env(safe-area-inset-bottom);\r\n}\r\n\r\n.tab-item {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 8rpx 0;\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.tab-item.active {\r\n  transform: scale(1.05);\r\n}\r\n\r\n.tab-icon {\r\n  margin-bottom: 4rpx;\r\n  transition: transform 0.2s ease;\r\n}\r\n\r\n.tab-item.active .tab-icon {\r\n  transform: scale(1.1);\r\n}\r\n\r\n.tab-text {\r\n  font-size: 20rpx;\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.tab-item.active .tab-text {\r\n  font-weight: 600;\r\n}\r\n</style> ","import Component from 'E:/personal/wx/uni-ui/components/CustomTabBar.vue'\nwx.createComponent(Component)"],"names":["ref","RouteGuard","LoginStateManager","uni","onMounted"],"mappings":";;;;;;;;;;;AA8CA,MAAM,cAAc;AACpB,MAAM,gBAAgB;;;;;;;;;;;AAbtB,UAAM,QAAQ;AAQd,UAAM,OAAO;AAGb,UAAM,eAAeA,cAAAA,IAAI,MAAM,OAAO;AAKtC,UAAM,UAAU;AAAA,MACd;AAAA,QACE,UAAU;AAAA,QACV,UAAU;AAAA,QACV,MAAM;AAAA,MACP;AAAA,MACD;AAAA,QACE,UAAU;AAAA,QACV,UAAU;AAAA,QACV,MAAM;AAAA,MACP;AAAA,MACD;AAAA,QACE,UAAU;AAAA,QACV,UAAU;AAAA,QACV,MAAM;AAAA,MACP;AAAA,MACD;AAAA,QACE,UAAU;AAAA,QACV,UAAU;AAAA,QACV,MAAM;AAAA,MACP;AAAA,IACH;AAGA,UAAM,YAAY,CAAC,KAAK,UAAU;AAChC,UAAI,aAAa,UAAU;AAAO;AAGlC,UAAIC,sBAAW,iBAAiB,IAAI,QAAQ,GAAG;AAC7C,cAAM,aAAaC,WAAiB,kBAAC,cAAe;AAEpD,YAAI,CAAC,YAAY;AACfC,gFAAY,kBAAkB,IAAI,QAAQ;AAG1CF,gCAAW,eAAe,IAAI,QAAQ;AAGtCE,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,SAAS;AAAA,YACT,aAAa;AAAA,YACb,YAAY;AAAA,YACZ,SAAS,CAAC,QAAQ;AAChB,kBAAI,IAAI,SAAS;AAEfA,8BAAAA,MAAI,WAAW;AAAA,kBACb,KAAK;AAAA,gBACnB,CAAa;AAAA,cACF;AAAA,YAEF;AAAA,UACT,CAAO;AAGD;AAAA,QACD;AAAA,MACF;AAGD,mBAAa,QAAQ;AACrB,WAAK,UAAU,KAAK;AAGpBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,KAAK,IAAI;AAAA,QACT,MAAM,MAAM;AAEVA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK,IAAI;AAAA,YACT,MAAM,MAAM;AAEVA,4BAAAA,MAAA,MAAA,SAAA,sCAAc,kBAAkB;AAKhCA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO;AAAA,gBACP,MAAM;AAAA,cAClB,CAAW;AAAA,YACF;AAAA,UACT,CAAO;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGAC,kBAAAA,UAAU,MAAM;AACd,mBAAa,QAAQ,MAAM;AAAA,IAC7B,CAAC;AAGD,aAAa;AAAA,MACX,iBAAiB,CAAC,UAAU;AAC1B,qBAAa,QAAQ;AAAA,MACtB;AAAA,IACH,CAAC;;;;;;;;;;;;;;;;;;;;;;;AClJD,GAAG,gBAAgB,SAAS;"}