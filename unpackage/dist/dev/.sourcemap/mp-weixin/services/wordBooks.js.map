{"version":3,"file":"wordBooks.js","sources":["services/wordBooks.js"],"sourcesContent":["import { get } from '@/utils/request.js'\r\nimport { API_ENDPOINTS } from '@/utils/constants.js'\r\n\r\nconst normalizeBook = (book) => ({\r\n  id: book.id,\r\n  name: book.name,\r\n  description: book.description,\r\n  language: book.language,\r\n  totalWords: book.total_words,\r\n  creatorId: book.created_by,\r\n  createdAt: book.created_at,\r\n  updatedAt: book.updated_at,\r\n  source: {\r\n    filename: book.source_filename,\r\n    storedPath: book.stored_path,\r\n    size: book.source_size\r\n  }\r\n})\r\n\r\nconst normalizeWord = (bookId, bookName, word) => {\r\n  const fallbackEnglish = word.word || word.extra?.english || ''\r\n  const fallbackChinese = word.translation || word.extra?.chinese || ''\r\n  return {\r\n    id: word.id ?? `${bookId}-${word.order_index}`,\r\n    bookId,\r\n    bookName,\r\n    english: fallbackEnglish,\r\n    chinese: fallbackChinese,\r\n    phonetic: word.phonetic || '',\r\n    definition: word.definition || '',\r\n    example: word.example_sentence || '',\r\n    partOfSpeech: word.part_of_speech || '',\r\n    tags: word.tags || [],\r\n    order: word.order_index ?? 0,\r\n    raw: word\r\n  }\r\n}\r\n\r\nexport const fetchWordBooks = async (params = {}) => {\r\n  const data = await get(API_ENDPOINTS.WORD_BOOKS.LIST, params)\r\n  const books = (data?.books || []).map(normalizeBook)\r\n  return {\r\n    books,\r\n    total: data?.total ?? books.length,\r\n    pagination: data?.pagination || {\r\n      page: params.page || 1,\r\n      limit: params.limit || books.length || 10,\r\n      total: data?.total ?? books.length,\r\n      totalPages: data?.pagination?.totalPages || 1\r\n    }\r\n  }\r\n}\r\n\r\nexport const fetchWordBookWords = async (bookId) => {\r\n  if (!bookId) {\r\n    throw new Error('bookId is required to load words')\r\n  }\r\n  const data = await get(API_ENDPOINTS.WORD_BOOKS.WORDS(bookId))\r\n  const bookName = data?.book?.name || ''\r\n  const words = (data?.words || []).map((item) => normalizeWord(bookId, bookName, item))\r\n  return {\r\n    book: normalizeBook(data?.book || { id: bookId, name: bookName }),\r\n    words,\r\n    total: data?.total ?? words.length\r\n  }\r\n}\r\n\r\nexport const findWordInBooks = (books, bookId) => {\r\n  return books.find((item) => item.id === bookId) || null\r\n}\r\n"],"names":["get","API_ENDPOINTS"],"mappings":";;;AAGA,MAAM,gBAAgB,CAAC,UAAU;AAAA,EAC/B,IAAI,KAAK;AAAA,EACT,MAAM,KAAK;AAAA,EACX,aAAa,KAAK;AAAA,EAClB,UAAU,KAAK;AAAA,EACf,YAAY,KAAK;AAAA,EACjB,WAAW,KAAK;AAAA,EAChB,WAAW,KAAK;AAAA,EAChB,WAAW,KAAK;AAAA,EAChB,QAAQ;AAAA,IACN,UAAU,KAAK;AAAA,IACf,YAAY,KAAK;AAAA,IACjB,MAAM,KAAK;AAAA,EACZ;AACH;AAEA,MAAM,gBAAgB,CAAC,QAAQ,UAAU,SAAS;;AAChD,QAAM,kBAAkB,KAAK,UAAQ,UAAK,UAAL,mBAAY,YAAW;AAC5D,QAAM,kBAAkB,KAAK,iBAAe,UAAK,UAAL,mBAAY,YAAW;AACnE,SAAO;AAAA,IACL,IAAI,KAAK,MAAM,GAAG,MAAM,IAAI,KAAK,WAAW;AAAA,IAC5C;AAAA,IACA;AAAA,IACA,SAAS;AAAA,IACT,SAAS;AAAA,IACT,UAAU,KAAK,YAAY;AAAA,IAC3B,YAAY,KAAK,cAAc;AAAA,IAC/B,SAAS,KAAK,oBAAoB;AAAA,IAClC,cAAc,KAAK,kBAAkB;AAAA,IACrC,MAAM,KAAK,QAAQ,CAAE;AAAA,IACrB,OAAO,KAAK,eAAe;AAAA,IAC3B,KAAK;AAAA,EACN;AACH;AAEY,MAAC,iBAAiB,OAAO,SAAS,OAAO;;AACnD,QAAM,OAAO,MAAMA,cAAG,IAACC,gBAAa,cAAC,WAAW,MAAM,MAAM;AAC5D,QAAM,UAAS,6BAAM,UAAS,CAAE,GAAE,IAAI,aAAa;AACnD,SAAO;AAAA,IACL;AAAA,IACA,QAAO,6BAAM,UAAS,MAAM;AAAA,IAC5B,aAAY,6BAAM,eAAc;AAAA,MAC9B,MAAM,OAAO,QAAQ;AAAA,MACrB,OAAO,OAAO,SAAS,MAAM,UAAU;AAAA,MACvC,QAAO,6BAAM,UAAS,MAAM;AAAA,MAC5B,cAAY,kCAAM,eAAN,mBAAkB,eAAc;AAAA,IAC7C;AAAA,EACF;AACH;AAEY,MAAC,qBAAqB,OAAO,WAAW;;AAClD,MAAI,CAAC,QAAQ;AACX,UAAM,IAAI,MAAM,kCAAkC;AAAA,EACnD;AACD,QAAM,OAAO,MAAMD,kBAAIC,gBAAAA,cAAc,WAAW,MAAM,MAAM,CAAC;AAC7D,QAAM,aAAW,kCAAM,SAAN,mBAAY,SAAQ;AACrC,QAAM,UAAS,6BAAM,UAAS,CAAA,GAAI,IAAI,CAAC,SAAS,cAAc,QAAQ,UAAU,IAAI,CAAC;AACrF,SAAO;AAAA,IACL,MAAM,eAAc,6BAAM,SAAQ,EAAE,IAAI,QAAQ,MAAM,UAAU;AAAA,IAChE;AAAA,IACA,QAAO,6BAAM,UAAS,MAAM;AAAA,EAC7B;AACH;;;"}