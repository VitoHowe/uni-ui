{"version":3,"file":"wrong-set.js","sources":["pkg-exam/pages/wrong-set/wrong-set.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGtnLWV4YW1ccGFnZXNcd3Jvbmctc2V0XHdyb25nLXNldC52dWU"],"sourcesContent":["<template>\n  <view class=\"wrong-set\">\n    <view class=\"subject-bar\">\n      <view class=\"subject-info\">\n        <text class=\"subject-label\">当前科目</text>\n        <text class=\"subject-name\">{{ subject?.name || '未选择科目' }}</text>\n      </view>\n    </view>\n\n    <view class=\"filter-bar\">\n      <view\n        v-for=\"item in modeOptions\"\n        :key=\"item.value\"\n        class=\"filter-item\"\n        :class=\"{ active: modeFilter === item.value }\"\n        @click=\"selectMode(item.value)\"\n      >\n        <text class=\"filter-text\">{{ item.label }}</text>\n      </view>\n    </view>\n\n    <view v-if=\"loading\" class=\"loading-state\">\n      <uni-icons type=\"spinner-cycle\" size=\"40\" color=\"#dc3545\" class=\"loading-icon\" />\n      <text class=\"loading-text\">正在加载错题...</text>\n    </view>\n\n    <view v-else-if=\"wrongQuestions.length === 0\" class=\"empty-state\">\n      <uni-icons type=\"checkmarkempty\" size=\"80\" color=\"#ddd\" />\n      <text class=\"empty-title\">暂无错题</text>\n      <text class=\"empty-desc\">继续加油，保持正确率</text>\n    </view>\n\n    <view v-else class=\"wrong-cards\">\n      <view class=\"wrong-card\" v-for=\"item in wrongQuestions\" :key=\"item.id\">\n        <view class=\"card-header\">\n          <text class=\"mode-tag\">{{ modeLabel(item.mode) }}</text>\n          <text class=\"source-name\">{{ item.source_name || '未知来源' }}</text>\n        </view>\n        <text class=\"question-content\">{{ getContentPreview(item.content) }}</text>\n        <view class=\"card-meta\">\n          <text class=\"meta-text\">错题次数 {{ item.wrong_times || 0 }}</text>\n          <text class=\"meta-text\">连续答对 {{ item.correct_streak || 0 }}</text>\n        </view>\n        <view class=\"card-actions\">\n          <button class=\"remove-btn\" @click=\"removeWrong(item)\">移除</button>\n        </view>\n      </view>\n    </view>\n\n    <view v-if=\"hasMore && wrongQuestions.length > 0\" class=\"load-more\">\n      <button class=\"load-more-btn\" @click=\"loadMore\">加载更多</button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { onShow } from '@dcloudio/uni-app'\nimport { get, del } from '@/utils/request.js'\nimport { SubjectStorage } from '@/pkg-exam/utils/subject.js'\n\nconst subject = ref(SubjectStorage.get())\nconst wrongQuestions = ref([])\nconst loading = ref(false)\nconst page = ref(1)\nconst limit = 20\nconst hasMore = ref(true)\nconst modeFilter = ref('all')\n\nconst modeOptions = [\n  { label: '全部', value: 'all' },\n  { label: '真题', value: 'real' },\n  { label: '模拟', value: 'mock' },\n  { label: '专项', value: 'special' },\n  { label: '随机', value: 'random' }\n]\n\nconst modeLabel = (mode) => {\n  const map = {\n    real: '真题',\n    mock: '模拟',\n    special: '专项',\n    random: '随机'\n  }\n  return map[mode] || '未知'\n}\n\nconst applySubjectFromRoute = () => {\n  const pages = getCurrentPages()\n  const currentPage = pages[pages.length - 1]\n  const subjectId = currentPage?.options?.subjectId\n  const subjectName = currentPage?.options?.subjectName\n  if (subjectId) {\n    subject.value = {\n      id: Number(subjectId),\n      name: subjectName ? decodeURIComponent(subjectName) : `科目 ${subjectId}`,\n      code: null\n    }\n    SubjectStorage.set(subject.value)\n  }\n}\n\nconst buildQuery = () => {\n  const params = {\n    subjectId: subject.value?.id || 0,\n    page: page.value,\n    limit\n  }\n  if (modeFilter.value !== 'all') {\n    params.mode = modeFilter.value\n  }\n  return params\n}\n\nconst fetchWrongQuestions = async (reset = false) => {\n  if (!subject.value?.id) return\n  if (loading.value) return\n  if (!hasMore.value && !reset) return\n\n  if (reset) {\n    page.value = 1\n    wrongQuestions.value = []\n    hasMore.value = true\n  }\n\n  loading.value = true\n  try {\n    const response = await get('/practice/wrong-questions', buildQuery(), { showLoading: false })\n    const items = response.items || []\n    wrongQuestions.value = reset ? items : wrongQuestions.value.concat(items)\n    const total = response.total || 0\n    hasMore.value = wrongQuestions.value.length < total\n    page.value += 1\n  } catch (error) {\n    console.error('获取错题集失败:', error)\n  } finally {\n    loading.value = false\n  }\n}\n\nconst selectMode = async (mode) => {\n  if (modeFilter.value === mode) return\n  modeFilter.value = mode\n  await fetchWrongQuestions(true)\n}\n\nconst loadMore = async () => {\n  await fetchWrongQuestions(false)\n}\n\nconst removeWrong = (item) => {\n  uni.showModal({\n    title: '移除错题',\n    content: '确定要移除此错题吗？',\n    success: async (res) => {\n      if (!res.confirm) return\n      try {\n        await del(`/practice/wrong-questions/${item.id}`, { showLoading: false })\n        wrongQuestions.value = wrongQuestions.value.filter(q => q.id !== item.id)\n      } catch (error) {\n        console.error('移除错题失败:', error)\n        uni.showToast({\n          title: error.message || '移除失败',\n          icon: 'none'\n        })\n      }\n    }\n  })\n}\n\nconst getContentPreview = (content) => {\n  if (!content) return ''\n  const text = String(content).replace(/<[^>]+>/g, '').replace(/\\s+/g, ' ').trim()\n  return text.length > 80 ? `${text.slice(0, 80)}...` : text\n}\n\nonShow(async () => {\n  applySubjectFromRoute()\n  await fetchWrongQuestions(true)\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.wrong-set {\n  --primary: #3b82f6;\n  --primary-strong: #2563eb;\n  --accent: #f97316;\n  --danger: #ef4444;\n  --bg: #f8fafc;\n  --card: #ffffff;\n  --text: #0f172a;\n  --muted: #64748b;\n  --border: #e2e8f0;\n  --shadow-soft: 0 10rpx 24rpx rgba(15, 23, 42, 0.08);\n  --shadow: 0 18rpx 32rpx rgba(15, 23, 42, 0.12);\n  padding: 20rpx;\n  background: radial-gradient(120% 120% at 10% 0%, #eff6ff 0%, transparent 55%),\n    radial-gradient(120% 120% at 100% 10%, #fff7ed 0%, transparent 45%),\n    var(--bg);\n  min-height: 100vh;\n  font-family: 'Poppins', 'Noto Sans SC', 'PingFang SC', 'Microsoft YaHei', sans-serif;\n  color: var(--text);\n}\n\n.subject-bar {\n  background: var(--card);\n  border-radius: 20rpx;\n  padding: 26rpx;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  border: 1rpx solid var(--border);\n  box-shadow: var(--shadow);\n  margin-bottom: 16rpx;\n}\n\n.subject-info {\n  display: flex;\n  flex-direction: column;\n  gap: 6rpx;\n}\n\n.subject-label {\n  font-size: 24rpx;\n  color: var(--muted);\n}\n\n.subject-name {\n  font-size: 30rpx;\n  font-weight: 600;\n  color: var(--text);\n}\n\n.filter-bar {\n  display: flex;\n  gap: 16rpx;\n  margin-bottom: 20rpx;\n  flex-wrap: wrap;\n}\n\n.filter-item {\n  padding: 12rpx 22rpx;\n  border-radius: 999rpx;\n  background: var(--card);\n  color: var(--muted);\n  font-size: 24rpx;\n  border: 1rpx solid var(--border);\n  box-shadow: var(--shadow-soft);\n}\n\n.filter-item.active {\n  background: var(--primary);\n  color: #fff;\n}\n\n.loading-state,\n.empty-state {\n  padding: 80rpx 20rpx;\n  text-align: center;\n  color: #999;\n}\n\n.empty-title {\n  display: block;\n  font-size: 30rpx;\n  color: #666;\n  margin-top: 20rpx;\n}\n\n.empty-desc {\n  display: block;\n  font-size: 24rpx;\n  margin-top: 10rpx;\n}\n\n.wrong-cards {\n  display: flex;\n  flex-direction: column;\n  gap: 16rpx;\n}\n\n.wrong-card {\n  background: var(--card);\n  border-radius: 18rpx;\n  padding: 24rpx;\n  border: 1rpx solid var(--border);\n  box-shadow: var(--shadow-soft);\n}\n\n.card-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 12rpx;\n}\n\n.mode-tag {\n  font-size: 22rpx;\n  color: var(--danger);\n  background: rgba(239, 68, 68, 0.12);\n  padding: 6rpx 14rpx;\n  border-radius: 999rpx;\n}\n\n.source-name {\n  font-size: 22rpx;\n  color: var(--muted);\n}\n\n.question-content {\n  font-size: 26rpx;\n  color: var(--text);\n  line-height: 1.6;\n}\n\n.card-meta {\n  display: flex;\n  gap: 16rpx;\n  margin-top: 12rpx;\n}\n\n.meta-text {\n  font-size: 22rpx;\n  color: var(--muted);\n}\n\n.card-actions {\n  margin-top: 16rpx;\n  display: flex;\n  justify-content: flex-end;\n}\n\n.remove-btn {\n  background: rgba(239, 68, 68, 0.12);\n  color: var(--danger);\n  font-size: 24rpx;\n  padding: 8rpx 24rpx;\n  border-radius: 999rpx;\n}\n\n.load-more {\n  margin: 20rpx 0;\n  display: flex;\n  justify-content: center;\n}\n\n.load-more-btn {\n  background: var(--card);\n  color: var(--muted);\n  font-size: 24rpx;\n  padding: 12rpx 32rpx;\n  border-radius: 999rpx;\n  border: 1rpx solid var(--border);\n  box-shadow: var(--shadow-soft);\n}\n</style>\n","import MiniProgramPage from 'E:/personal/wx/uni-ui/pkg-exam/pages/wrong-set/wrong-set.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","SubjectStorage","get","uni","del","onShow"],"mappings":"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"}