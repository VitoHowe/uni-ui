{"version":3,"file":"real-exam-list.js","sources":["pkg-exam/pages/real-exam-list/real-exam-list.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGtnLWV4YW1ccGFnZXNccmVhbC1leGFtLWxpc3RccmVhbC1leGFtLWxpc3QudnVl"],"sourcesContent":["<template>\n  <view class=\"real-exam-list\">\n    <view class=\"subject-bar\" @click=\"openSubjectPicker\">\n      <view class=\"subject-info\">\n        <text class=\"subject-label\">当前科目</text>\n        <text class=\"subject-name\">{{ selectedSubject?.name || '请选择科目' }}</text>\n      </view>\n      <view class=\"subject-action\">\n        <text class=\"subject-action-text\">{{ subjects.length ? '切换' : '加载中' }}</text>\n        <uni-icons type=\"arrowdown\" size=\"16\" color=\"#999\" />\n      </view>\n    </view>\n\n    <view class=\"practice-stats\">\n      <view class=\"stat-card\">\n        <text class=\"stat-number\">{{ practiceStats.answered_count }}</text>\n        <text class=\"stat-label\">已作答</text>\n      </view>\n      <view class=\"stat-card\">\n        <text class=\"stat-number\">{{ practiceStats.accuracy }}%</text>\n        <text class=\"stat-label\">正确率</text>\n      </view>\n      <view class=\"stat-card\">\n        <text class=\"stat-number\">{{ practiceStats.wrong_count }}</text>\n        <text class=\"stat-label\">错题数</text>\n      </view>\n    </view>\n\n    <view class=\"paper-list\">\n      <view v-if=\"loading\" class=\"loading-state\">\n        <uni-icons type=\"spinner-cycle\" size=\"40\" color=\"#3B82F6\" class=\"loading-icon\" />\n        <text class=\"loading-text\">正在加载试卷...</text>\n      </view>\n\n      <view v-else-if=\"papers.length === 0\" class=\"empty-state\">\n        <uni-icons type=\"folder-add\" size=\"80\" color=\"#ddd\" />\n        <text class=\"empty-title\">暂无真题</text>\n        <text class=\"empty-desc\">当前科目还没有真题试卷</text>\n      </view>\n\n      <view v-else class=\"paper-cards\">\n        <view class=\"paper-card\" v-for=\"paper in papers\" :key=\"paper.id\" @click=\"startPaper(paper)\">\n          <view class=\"card-header\">\n            <text class=\"paper-name\">{{ paper.name }}</text>\n            <text class=\"paper-count\">{{ paper.total_questions || 0 }} 题</text>\n          </view>\n          <text v-if=\"paper.description\" class=\"paper-desc\">{{ paper.description }}</text>\n          <view class=\"card-footer\">\n            <text class=\"paper-date\">{{ formatDate(paper.created_at) }}</text>\n            <view class=\"start-btn\">开始练习</view>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { onShow } from '@dcloudio/uni-app'\nimport { get } from '@/utils/request.js'\nimport { SubjectStorage, normalizeSubject } from '@/pkg-exam/utils/subject.js'\n\nconst papers = ref([])\nconst loading = ref(false)\nconst subjects = ref([])\nconst selectedSubject = ref(SubjectStorage.get())\nconst loadingSubjects = ref(false)\nconst practiceStats = ref({\n  answered_count: 0,\n  correct_count: 0,\n  wrong_count: 0,\n  accuracy: 0\n})\n\nconst syncSelectedSubject = (subject) => {\n  selectedSubject.value = subject\n  SubjectStorage.set(subject)\n}\n\nconst applySubjectFromRoute = () => {\n  const pages = getCurrentPages()\n  const currentPage = pages[pages.length - 1]\n  const subjectId = currentPage?.options?.subjectId\n  const subjectName = currentPage?.options?.subjectName\n  if (subjectId) {\n    syncSelectedSubject({\n      id: Number(subjectId),\n      name: subjectName ? decodeURIComponent(subjectName) : `科目 ${subjectId}`,\n      code: null\n    })\n  }\n}\n\nconst ensureSubjectSelected = () => {\n  if (selectedSubject.value) return true\n  uni.showToast({\n    title: '请先选择科目',\n    icon: 'none'\n  })\n  return false\n}\n\nconst fetchSubjects = async () => {\n  if (loadingSubjects.value) return\n  loadingSubjects.value = true\n  try {\n    const data = await get('/subjects')\n    const list = (data.subjects || []).map(normalizeSubject)\n    subjects.value = list\n\n    if (!selectedSubject.value && list.length) {\n      syncSelectedSubject(list[0])\n      return\n    }\n\n    if (selectedSubject.value) {\n      const matched = list.find(item => item.id === selectedSubject.value.id)\n      if (matched) {\n        syncSelectedSubject(matched)\n      } else if (list.length) {\n        syncSelectedSubject(list[0])\n      }\n    }\n  } catch (error) {\n    console.error('获取科目失败:', error)\n    uni.showToast({\n      title: error.message || '获取科目失败',\n      icon: 'none'\n    })\n  } finally {\n    loadingSubjects.value = false\n  }\n}\n\nconst resetPracticeStats = () => {\n  practiceStats.value = {\n    answered_count: 0,\n    correct_count: 0,\n    wrong_count: 0,\n    accuracy: 0\n  }\n}\n\nconst fetchPracticeSummary = async () => {\n  if (!ensureSubjectSelected()) {\n    resetPracticeStats()\n    return\n  }\n  try {\n    const response = await get(\n      '/practice/summary',\n      { subjectId: selectedSubject.value.id, mode: 'real' },\n      { showLoading: false }\n    )\n    practiceStats.value = response.stats || {\n      answered_count: 0,\n      correct_count: 0,\n      wrong_count: 0,\n      accuracy: 0\n    }\n  } catch (error) {\n    console.error('获取练习统计失败:', error)\n    resetPracticeStats()\n  }\n}\n\nconst fetchPapers = async () => {\n  if (!ensureSubjectSelected()) {\n    papers.value = []\n    return\n  }\n  loading.value = true\n  try {\n    const response = await get('/real-exams', {\n      subjectId: selectedSubject.value.id,\n      page: 1,\n      limit: 20\n    })\n    papers.value = response.papers || []\n  } catch (error) {\n    console.error('获取真题失败:', error)\n    uni.showToast({\n      title: error.message || '获取真题失败',\n      icon: 'none'\n    })\n  } finally {\n    loading.value = false\n  }\n}\n\nconst openSubjectPicker = () => {\n  if (loadingSubjects.value) return\n  if (!subjects.value.length) {\n    uni.showToast({\n      title: '暂无可选科目',\n      icon: 'none'\n    })\n    return\n  }\n  uni.showActionSheet({\n    itemList: subjects.value.map(item => item.name),\n    success: async (res) => {\n      const subject = subjects.value[res.tapIndex]\n      if (subject) {\n        syncSelectedSubject(subject)\n        await fetchPracticeSummary()\n        await fetchPapers()\n      }\n    }\n  })\n}\n\nconst startPaper = (paper) => {\n  const subjectId = selectedSubject.value?.id || 0\n  const subjectName = selectedSubject.value?.name || ''\n  const paperName = paper.name || ''\n  uni.navigateTo({\n    url: `/pkg-exam/pages/exam/exam?mode=real&paperId=${paper.id}&subjectId=${subjectId}&subjectName=${encodeURIComponent(subjectName)}&paperName=${encodeURIComponent(paperName)}`\n  })\n}\n\nconst formatDate = (dateStr) => {\n  if (!dateStr) return ''\n  return new Date(dateStr).toLocaleDateString()\n}\n\nonShow(async () => {\n  applySubjectFromRoute()\n  const stored = SubjectStorage.get()\n  if (stored) {\n    selectedSubject.value = stored\n  }\n  await fetchSubjects()\n  await fetchPracticeSummary()\n  await fetchPapers()\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.real-exam-list {\n  --primary: #3b82f6;\n  --primary-strong: #2563eb;\n  --accent: #f97316;\n  --bg: #f8fafc;\n  --card: #ffffff;\n  --text: #0f172a;\n  --muted: #64748b;\n  --border: #e2e8f0;\n  --shadow-soft: 0 10rpx 24rpx rgba(15, 23, 42, 0.08);\n  --shadow: 0 18rpx 32rpx rgba(15, 23, 42, 0.12);\n  padding: 20rpx;\n  background: radial-gradient(120% 120% at 12% 0%, #eff6ff 0%, transparent 55%),\n    radial-gradient(120% 120% at 100% 12%, #fff7ed 0%, transparent 45%),\n    var(--bg);\n  min-height: 100vh;\n  font-family: 'Poppins', 'Noto Sans SC', 'PingFang SC', 'Microsoft YaHei', sans-serif;\n  color: var(--text);\n}\n\n.subject-bar {\n  background: var(--card);\n  border-radius: 20rpx;\n  padding: 26rpx;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  border: 1rpx solid var(--border);\n  box-shadow: var(--shadow);\n  margin-bottom: 20rpx;\n}\n\n.practice-stats {\n  display: flex;\n  gap: 16rpx;\n  margin-bottom: 20rpx;\n}\n\n.stat-card {\n  flex: 1;\n  background: var(--card);\n  border-radius: 18rpx;\n  padding: 20rpx 12rpx;\n  text-align: center;\n  border: 1rpx solid var(--border);\n  box-shadow: var(--shadow-soft);\n}\n\n.stat-number {\n  display: block;\n  font-size: 32rpx;\n  font-weight: 600;\n  color: var(--text);\n}\n\n.stat-label {\n  display: block;\n  margin-top: 6rpx;\n  font-size: 22rpx;\n  color: var(--muted);\n}\n\n.subject-info {\n  display: flex;\n  flex-direction: column;\n  gap: 6rpx;\n}\n\n.subject-label {\n  font-size: 24rpx;\n  color: var(--muted);\n}\n\n.subject-name {\n  font-size: 30rpx;\n  font-weight: 600;\n  color: var(--text);\n}\n\n.subject-action {\n  display: flex;\n  align-items: center;\n  gap: 10rpx;\n}\n\n.subject-action-text {\n  font-size: 24rpx;\n  color: var(--primary);\n  font-weight: 600;\n}\n\n.paper-list {\n  margin-top: 10rpx;\n}\n\n.loading-state,\n.empty-state {\n  padding: 80rpx 20rpx;\n  text-align: center;\n  color: #999;\n}\n\n.empty-title {\n  display: block;\n  font-size: 30rpx;\n  color: #666;\n  margin-top: 20rpx;\n}\n\n.empty-desc {\n  display: block;\n  font-size: 24rpx;\n  margin-top: 10rpx;\n}\n\n.paper-card {\n  background: var(--card);\n  border-radius: 18rpx;\n  padding: 24rpx;\n  margin-bottom: 20rpx;\n  border: 1rpx solid var(--border);\n  box-shadow: var(--shadow-soft);\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.paper-name {\n  font-size: 30rpx;\n  font-weight: 600;\n  color: var(--text);\n}\n\n.paper-count {\n  font-size: 24rpx;\n  color: var(--primary);\n  font-weight: 600;\n}\n\n.paper-desc {\n  display: block;\n  margin-top: 12rpx;\n  font-size: 24rpx;\n  color: var(--muted);\n}\n\n.card-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 18rpx;\n}\n\n.paper-date {\n  font-size: 22rpx;\n  color: var(--muted);\n}\n\n.start-btn {\n  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-strong) 100%);\n  color: #fff;\n  padding: 12rpx 22rpx;\n  border-radius: 999rpx;\n  font-size: 24rpx;\n  box-shadow: 0 6rpx 16rpx rgba(59, 130, 246, 0.25);\n}\n</style>\n","import MiniProgramPage from 'E:/personal/wx/uni-ui/pkg-exam/pages/real-exam-list/real-exam-list.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","SubjectStorage","uni","get","normalizeSubject","onShow"],"mappings":"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"}