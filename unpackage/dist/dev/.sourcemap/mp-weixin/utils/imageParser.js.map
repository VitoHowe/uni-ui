{"version":3,"file":"imageParser.js","sources":["utils/imageParser.js"],"sourcesContent":["/**\n * 图片解析工具\n * 用于处理题目中的图片占位符 ${images/xxx.jpg}\n */\n\n/**\n * 解析题目中的图片占位符，转换为HTML标签\n * @param {string} text - 原始文本内容\n * @param {number} bankId - 题库ID\n * @param {string} baseUrl - API基础URL（不包含/api）\n * @returns {string} 包含HTML标签的富文本\n */\nexport function parseQuestionImages(text, bankId, baseUrl = 'http://localhost:3001') {\n  if (!text) return ''\n  \n  let parsedText = text\n  \n  // 1. 替换图片占位符为 <img> 标签\n  parsedText = parsedText.replace(\n    /\\$\\{images\\/([^}]+)\\}/g,\n    (match, filename) => {\n      const imageUrl = `${baseUrl}/api/question-banks/${bankId}/images/${filename}`\n      return `<img src=\"${imageUrl}\" class=\"question-image\" style=\"max-width:100%;border-radius:12rpx;margin:20rpx 0;box-shadow:0 4rpx 12rpx rgba(0,0,0,0.08);display:block;background:#f5f7fa;\" />`\n    }\n  )\n  \n  // 2. 处理换行符，转换为 <br/>\n  parsedText = parsedText.replace(/\\n\\n/g, '<br/><br/>')\n  parsedText = parsedText.replace(/\\n/g, '<br/>')\n  \n  return parsedText\n}\n\n/**\n * 提取文本中的所有图片URL（用于图片预览）\n * @param {string} text - 原始文本内容\n * @param {number} bankId - 题库ID\n * @param {string} baseUrl - API基础URL（不包含/api）\n * @returns {Array<string>} 图片URL数组\n */\nexport function extractImageUrls(text, bankId, baseUrl = 'http://localhost:3001') {\n  if (!text) return []\n  \n  const urls = []\n  const regex = /\\$\\{images\\/([^}]+)\\}/g\n  let match\n  \n  while ((match = regex.exec(text)) !== null) {\n    const filename = match[1]\n    urls.push(`${baseUrl}/api/question-banks/${bankId}/images/${filename}`)\n  }\n  \n  return urls\n}\n\n/**\n * 从多个文本字段中提取所有图片URL\n * @param {Object} question - 题目对象\n * @param {number} bankId - 题库ID\n * @param {string} baseUrl - API基础URL\n * @returns {Array<string>} 所有图片URL数组\n */\nexport function extractAllQuestionImages(question, bankId, baseUrl = 'http://localhost:3001') {\n  if (!question) return []\n  \n  const urls = []\n  \n  // 从题目内容中提取\n  if (question.content) {\n    urls.push(...extractImageUrls(question.content, bankId, baseUrl))\n  }\n  \n  // 从解析说明中提取\n  if (question.explanation) {\n    urls.push(...extractImageUrls(question.explanation, bankId, baseUrl))\n  }\n  \n  return urls\n}\n"],"names":[],"mappings":";AAYO,SAAS,oBAAoB,MAAM,QAAQ,UAAU,yBAAyB;AACnF,MAAI,CAAC;AAAM,WAAO;AAElB,MAAI,aAAa;AAGjB,eAAa,WAAW;AAAA,IACtB;AAAA,IACA,CAAC,OAAO,aAAa;AACnB,YAAM,WAAW,GAAG,OAAO,uBAAuB,MAAM,WAAW,QAAQ;AAC3E,aAAO,aAAa,QAAQ;AAAA,IAC7B;AAAA,EACF;AAGD,eAAa,WAAW,QAAQ,SAAS,YAAY;AACrD,eAAa,WAAW,QAAQ,OAAO,OAAO;AAE9C,SAAO;AACT;AASO,SAAS,iBAAiB,MAAM,QAAQ,UAAU,yBAAyB;AAChF,MAAI,CAAC;AAAM,WAAO,CAAE;AAEpB,QAAM,OAAO,CAAE;AACf,QAAM,QAAQ;AACd,MAAI;AAEJ,UAAQ,QAAQ,MAAM,KAAK,IAAI,OAAO,MAAM;AAC1C,UAAM,WAAW,MAAM,CAAC;AACxB,SAAK,KAAK,GAAG,OAAO,uBAAuB,MAAM,WAAW,QAAQ,EAAE;AAAA,EACvE;AAED,SAAO;AACT;AASO,SAAS,yBAAyB,UAAU,QAAQ,UAAU,yBAAyB;AAC5F,MAAI,CAAC;AAAU,WAAO,CAAE;AAExB,QAAM,OAAO,CAAE;AAGf,MAAI,SAAS,SAAS;AACpB,SAAK,KAAK,GAAG,iBAAiB,SAAS,SAAS,QAAQ,OAAO,CAAC;AAAA,EACjE;AAGD,MAAI,SAAS,aAAa;AACxB,SAAK,KAAK,GAAG,iBAAiB,SAAS,aAAa,QAAQ,OAAO,CAAC;AAAA,EACrE;AAED,SAAO;AACT;;;"}