{"version":3,"file":"wordProgress.js","sources":["utils/wordProgress.js"],"sourcesContent":["const STORAGE_PREFIX = 'WORD_PRACTICE_PROGRESS::'\n\nconst normalizeList = (list) => {\n  if (!Array.isArray(list)) return []\n  const deduped = Array.from(new Set(list.filter(Boolean)))\n  return deduped\n}\n\nconst nextTimestamp = () => new Date().toISOString()\n\nexport const createEmptyProgress = () => ({\n  favorites: [],\n  mistakes: [],\n  mastered: [],\n  lastCursor: 0,\n  updatedAt: nextTimestamp()\n})\n\nconst getStorageKey = (bookId) => `${STORAGE_PREFIX}${bookId}`\n\nexport const readBookProgress = (bookId) => {\n  if (!bookId) return createEmptyProgress()\n  try {\n    const snapshot = uni.getStorageSync(getStorageKey(bookId)) || {}\n    return {\n      favorites: normalizeList(snapshot.favorites),\n      mistakes: normalizeList(snapshot.mistakes),\n      mastered: normalizeList(snapshot.mastered),\n      lastCursor: Number.isInteger(snapshot.lastCursor) ? snapshot.lastCursor : 0,\n      updatedAt: snapshot.updatedAt || nextTimestamp()\n    }\n  } catch (error) {\n    console.warn('读取单词进度失败', error)\n    return createEmptyProgress()\n  }\n}\n\nexport const persistBookProgress = (bookId, progress) => {\n  if (!bookId) return\n  const payload = {\n    favorites: normalizeList(progress.favorites),\n    mistakes: normalizeList(progress.mistakes),\n    mastered: normalizeList(progress.mastered),\n    lastCursor: progress.lastCursor ?? 0,\n    updatedAt: nextTimestamp()\n  }\n  uni.setStorageSync(getStorageKey(bookId), payload)\n  return payload\n}\n\nexport const clearBookProgress = (bookId) => {\n  if (!bookId) return\n  uni.removeStorageSync(getStorageKey(bookId))\n}\n\nexport const updateWordStatus = (progress, wordId, bucket) => {\n  const next = {\n    favorites: normalizeList(progress.favorites),\n    mistakes: normalizeList(progress.mistakes),\n    mastered: normalizeList(progress.mastered),\n    lastCursor: progress.lastCursor ?? 0,\n    updatedAt: progress.updatedAt\n  }\n\n  const removeFromAll = (id) => {\n    next.favorites = next.favorites.filter((word) => word !== id)\n    next.mistakes = next.mistakes.filter((word) => word !== id)\n    next.mastered = next.mastered.filter((word) => word !== id)\n  }\n\n  removeFromAll(wordId)\n\n  if (bucket === 'favorite') {\n    next.favorites.push(wordId)\n  }\n  if (bucket === 'mistake') {\n    next.mistakes.push(wordId)\n  }\n  if (bucket === 'mastered') {\n    next.mastered.push(wordId)\n  }\n\n  return {\n    ...next,\n    favorites: normalizeList(next.favorites),\n    mistakes: normalizeList(next.mistakes),\n    mastered: normalizeList(next.mastered)\n  }\n}\n\nexport const updateCursor = (progress, cursor) => ({\n  ...progress,\n  lastCursor: cursor\n})\n"],"names":["uni"],"mappings":";;AAAA,MAAM,iBAAiB;AAEvB,MAAM,gBAAgB,CAAC,SAAS;AAC9B,MAAI,CAAC,MAAM,QAAQ,IAAI;AAAG,WAAO,CAAE;AACnC,QAAM,UAAU,MAAM,KAAK,IAAI,IAAI,KAAK,OAAO,OAAO,CAAC,CAAC;AACxD,SAAO;AACT;AAEA,MAAM,gBAAgB,OAAM,oBAAI,KAAM,GAAC,YAAa;AAExC,MAAC,sBAAsB,OAAO;AAAA,EACxC,WAAW,CAAE;AAAA,EACb,UAAU,CAAE;AAAA,EACZ,UAAU,CAAE;AAAA,EACZ,YAAY;AAAA,EACZ,WAAW,cAAe;AAC5B;AAEA,MAAM,gBAAgB,CAAC,WAAW,GAAG,cAAc,GAAG,MAAM;AAEhD,MAAC,mBAAmB,CAAC,WAAW;AAC1C,MAAI,CAAC;AAAQ,WAAO,oBAAqB;AACzC,MAAI;AACF,UAAM,WAAWA,cAAAA,MAAI,eAAe,cAAc,MAAM,CAAC,KAAK,CAAE;AAChE,WAAO;AAAA,MACL,WAAW,cAAc,SAAS,SAAS;AAAA,MAC3C,UAAU,cAAc,SAAS,QAAQ;AAAA,MACzC,UAAU,cAAc,SAAS,QAAQ;AAAA,MACzC,YAAY,OAAO,UAAU,SAAS,UAAU,IAAI,SAAS,aAAa;AAAA,MAC1E,WAAW,SAAS,aAAa,cAAe;AAAA,IACjD;AAAA,EACF,SAAQ,OAAO;AACdA,kBAAAA,MAAA,MAAA,QAAA,+BAAa,YAAY,KAAK;AAC9B,WAAO,oBAAqB;AAAA,EAC7B;AACH;AAEY,MAAC,sBAAsB,CAAC,QAAQ,aAAa;AACvD,MAAI,CAAC;AAAQ;AACb,QAAM,UAAU;AAAA,IACd,WAAW,cAAc,SAAS,SAAS;AAAA,IAC3C,UAAU,cAAc,SAAS,QAAQ;AAAA,IACzC,UAAU,cAAc,SAAS,QAAQ;AAAA,IACzC,YAAY,SAAS,cAAc;AAAA,IACnC,WAAW,cAAe;AAAA,EAC3B;AACDA,gBAAAA,MAAI,eAAe,cAAc,MAAM,GAAG,OAAO;AACjD,SAAO;AACT;AAOY,MAAC,mBAAmB,CAAC,UAAU,QAAQ,WAAW;AAC5D,QAAM,OAAO;AAAA,IACX,WAAW,cAAc,SAAS,SAAS;AAAA,IAC3C,UAAU,cAAc,SAAS,QAAQ;AAAA,IACzC,UAAU,cAAc,SAAS,QAAQ;AAAA,IACzC,YAAY,SAAS,cAAc;AAAA,IACnC,WAAW,SAAS;AAAA,EACrB;AAED,QAAM,gBAAgB,CAAC,OAAO;AAC5B,SAAK,YAAY,KAAK,UAAU,OAAO,CAAC,SAAS,SAAS,EAAE;AAC5D,SAAK,WAAW,KAAK,SAAS,OAAO,CAAC,SAAS,SAAS,EAAE;AAC1D,SAAK,WAAW,KAAK,SAAS,OAAO,CAAC,SAAS,SAAS,EAAE;AAAA,EAC3D;AAED,gBAAc,MAAM;AAEpB,MAAI,WAAW,YAAY;AACzB,SAAK,UAAU,KAAK,MAAM;AAAA,EAC3B;AACD,MAAI,WAAW,WAAW;AACxB,SAAK,SAAS,KAAK,MAAM;AAAA,EAC1B;AACD,MAAI,WAAW,YAAY;AACzB,SAAK,SAAS,KAAK,MAAM;AAAA,EAC1B;AAED,SAAO;AAAA,IACL,GAAG;AAAA,IACH,WAAW,cAAc,KAAK,SAAS;AAAA,IACvC,UAAU,cAAc,KAAK,QAAQ;AAAA,IACrC,UAAU,cAAc,KAAK,QAAQ;AAAA,EACtC;AACH;AAEY,MAAC,eAAe,CAAC,UAAU,YAAY;AAAA,EACjD,GAAG;AAAA,EACH,YAAY;AACd;;;;;;"}