{"version":3,"file":"wordProgress.js","sources":["utils/wordProgress.js"],"sourcesContent":["const STORAGE_PREFIX = 'WORD_PRACTICE_PROGRESS::'\r\n\r\nconst normalizeList = (list) => {\r\n  if (!Array.isArray(list)) return []\r\n  const deduped = Array.from(new Set(list.filter(Boolean)))\r\n  return deduped\r\n}\r\n\r\nconst nextTimestamp = () => new Date().toISOString()\r\n\r\nexport const createEmptyProgress = () => ({\r\n  favorites: [],\r\n  mistakes: [],\r\n  mastered: [],\r\n  lastCursor: 0,\r\n  updatedAt: nextTimestamp()\r\n})\r\n\r\nconst getStorageKey = (bookId) => `${STORAGE_PREFIX}${bookId}`\r\n\r\nexport const readBookProgress = (bookId) => {\r\n  if (!bookId) return createEmptyProgress()\r\n  try {\r\n    const snapshot = uni.getStorageSync(getStorageKey(bookId)) || {}\r\n    return {\r\n      favorites: normalizeList(snapshot.favorites),\r\n      mistakes: normalizeList(snapshot.mistakes),\r\n      mastered: normalizeList(snapshot.mastered),\r\n      lastCursor: Number.isInteger(snapshot.lastCursor) ? snapshot.lastCursor : 0,\r\n      updatedAt: snapshot.updatedAt || nextTimestamp()\r\n    }\r\n  } catch (error) {\r\n    console.warn('读取单词进度失败', error)\r\n    return createEmptyProgress()\r\n  }\r\n}\r\n\r\nexport const persistBookProgress = (bookId, progress) => {\r\n  if (!bookId) return\r\n  const payload = {\r\n    favorites: normalizeList(progress.favorites),\r\n    mistakes: normalizeList(progress.mistakes),\r\n    mastered: normalizeList(progress.mastered),\r\n    lastCursor: progress.lastCursor ?? 0,\r\n    updatedAt: nextTimestamp()\r\n  }\r\n  uni.setStorageSync(getStorageKey(bookId), payload)\r\n  return payload\r\n}\r\n\r\nexport const clearBookProgress = (bookId) => {\r\n  if (!bookId) return\r\n  uni.removeStorageSync(getStorageKey(bookId))\r\n}\r\n\r\nexport const updateWordStatus = (progress, wordId, bucket) => {\r\n  const next = {\r\n    favorites: normalizeList(progress.favorites),\r\n    mistakes: normalizeList(progress.mistakes),\r\n    mastered: normalizeList(progress.mastered),\r\n    lastCursor: progress.lastCursor ?? 0,\r\n    updatedAt: progress.updatedAt\r\n  }\r\n\r\n  const removeFromAll = (id) => {\r\n    next.favorites = next.favorites.filter((word) => word !== id)\r\n    next.mistakes = next.mistakes.filter((word) => word !== id)\r\n    next.mastered = next.mastered.filter((word) => word !== id)\r\n  }\r\n\r\n  removeFromAll(wordId)\r\n\r\n  if (bucket === 'favorite') {\r\n    next.favorites.push(wordId)\r\n  }\r\n  if (bucket === 'mistake') {\r\n    next.mistakes.push(wordId)\r\n  }\r\n  if (bucket === 'mastered') {\r\n    next.mastered.push(wordId)\r\n  }\r\n\r\n  return {\r\n    ...next,\r\n    favorites: normalizeList(next.favorites),\r\n    mistakes: normalizeList(next.mistakes),\r\n    mastered: normalizeList(next.mastered)\r\n  }\r\n}\r\n\r\nexport const updateCursor = (progress, cursor) => ({\r\n  ...progress,\r\n  lastCursor: cursor\r\n})\r\n"],"names":["uni"],"mappings":";;AAAA,MAAM,iBAAiB;AAEvB,MAAM,gBAAgB,CAAC,SAAS;AAC9B,MAAI,CAAC,MAAM,QAAQ,IAAI;AAAG,WAAO,CAAE;AACnC,QAAM,UAAU,MAAM,KAAK,IAAI,IAAI,KAAK,OAAO,OAAO,CAAC,CAAC;AACxD,SAAO;AACT;AAEA,MAAM,gBAAgB,OAAM,oBAAI,KAAM,GAAC,YAAa;AAExC,MAAC,sBAAsB,OAAO;AAAA,EACxC,WAAW,CAAE;AAAA,EACb,UAAU,CAAE;AAAA,EACZ,UAAU,CAAE;AAAA,EACZ,YAAY;AAAA,EACZ,WAAW,cAAe;AAC5B;AAEA,MAAM,gBAAgB,CAAC,WAAW,GAAG,cAAc,GAAG,MAAM;AAEhD,MAAC,mBAAmB,CAAC,WAAW;AAC1C,MAAI,CAAC;AAAQ,WAAO,oBAAqB;AACzC,MAAI;AACF,UAAM,WAAWA,cAAAA,MAAI,eAAe,cAAc,MAAM,CAAC,KAAK,CAAE;AAChE,WAAO;AAAA,MACL,WAAW,cAAc,SAAS,SAAS;AAAA,MAC3C,UAAU,cAAc,SAAS,QAAQ;AAAA,MACzC,UAAU,cAAc,SAAS,QAAQ;AAAA,MACzC,YAAY,OAAO,UAAU,SAAS,UAAU,IAAI,SAAS,aAAa;AAAA,MAC1E,WAAW,SAAS,aAAa,cAAe;AAAA,IACjD;AAAA,EACF,SAAQ,OAAO;AACdA,kBAAAA,MAAA,MAAA,QAAA,+BAAa,YAAY,KAAK;AAC9B,WAAO,oBAAqB;AAAA,EAC7B;AACH;AAEY,MAAC,sBAAsB,CAAC,QAAQ,aAAa;AACvD,MAAI,CAAC;AAAQ;AACb,QAAM,UAAU;AAAA,IACd,WAAW,cAAc,SAAS,SAAS;AAAA,IAC3C,UAAU,cAAc,SAAS,QAAQ;AAAA,IACzC,UAAU,cAAc,SAAS,QAAQ;AAAA,IACzC,YAAY,SAAS,cAAc;AAAA,IACnC,WAAW,cAAe;AAAA,EAC3B;AACDA,gBAAAA,MAAI,eAAe,cAAc,MAAM,GAAG,OAAO;AACjD,SAAO;AACT;AAOY,MAAC,mBAAmB,CAAC,UAAU,QAAQ,WAAW;AAC5D,QAAM,OAAO;AAAA,IACX,WAAW,cAAc,SAAS,SAAS;AAAA,IAC3C,UAAU,cAAc,SAAS,QAAQ;AAAA,IACzC,UAAU,cAAc,SAAS,QAAQ;AAAA,IACzC,YAAY,SAAS,cAAc;AAAA,IACnC,WAAW,SAAS;AAAA,EACrB;AAED,QAAM,gBAAgB,CAAC,OAAO;AAC5B,SAAK,YAAY,KAAK,UAAU,OAAO,CAAC,SAAS,SAAS,EAAE;AAC5D,SAAK,WAAW,KAAK,SAAS,OAAO,CAAC,SAAS,SAAS,EAAE;AAC1D,SAAK,WAAW,KAAK,SAAS,OAAO,CAAC,SAAS,SAAS,EAAE;AAAA,EAC3D;AAED,gBAAc,MAAM;AAEpB,MAAI,WAAW,YAAY;AACzB,SAAK,UAAU,KAAK,MAAM;AAAA,EAC3B;AACD,MAAI,WAAW,WAAW;AACxB,SAAK,SAAS,KAAK,MAAM;AAAA,EAC1B;AACD,MAAI,WAAW,YAAY;AACzB,SAAK,SAAS,KAAK,MAAM;AAAA,EAC1B;AAED,SAAO;AAAA,IACL,GAAG;AAAA,IACH,WAAW,cAAc,KAAK,SAAS;AAAA,IACvC,UAAU,cAAc,KAAK,QAAQ;AAAA,IACrC,UAAU,cAAc,KAAK,QAAQ;AAAA,EACtC;AACH;AAEY,MAAC,eAAe,CAAC,UAAU,YAAY;AAAA,EACjD,GAAG;AAAA,EACH,YAAY;AACd;;;;;;"}