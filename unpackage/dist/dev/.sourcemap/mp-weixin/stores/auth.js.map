{"version":3,"file":"auth.js","sources":["stores/auth.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { request } from '@/utils/request.js'\r\nimport { API_ENDPOINTS } from '@/utils/constants.js'\r\nimport { \r\n  TokenManager, \r\n  UserManager, \r\n  WechatAuth, \r\n  LoginStateManager \r\n} from '@/utils/auth.js'\r\nimport NavigationGuard from '@/utils/navigationGuard.js'\r\n\r\n/**\r\n * è®¤è¯çŠ¶æ€ç®¡ç†Store\r\n */\r\nexport const useAuthStore = defineStore('auth', {\r\n  state: () => ({\r\n    // ç™»å½•çŠ¶æ€\r\n    isLoggedIn: false,\r\n    \r\n    // ç”¨æˆ·ä¿¡æ¯\r\n    user: null,\r\n    \r\n    // åŠ è½½çŠ¶æ€\r\n    loading: {\r\n      login: false,\r\n      refresh: false,\r\n      profile: false\r\n    },\r\n    \r\n    // Tokenä¿¡æ¯ï¼ˆä»…ç”¨äºçŠ¶æ€æ˜¾ç¤ºï¼Œå®é™…å­˜å‚¨åœ¨TokenManagerä¸­ï¼‰\r\n    tokenInfo: {\r\n      hasToken: false,\r\n      expiresAt: null\r\n    }\r\n  }),\r\n  \r\n  getters: {\r\n    /**\r\n     * æ˜¯å¦å·²è®¤è¯\r\n     */\r\n    isAuthenticated: (state) => {\r\n      return state.isLoggedIn && state.user && TokenManager.getAccessToken()\r\n    },\r\n    \r\n    /**\r\n     * ç”¨æˆ·æ˜µç§°\r\n     */\r\n    userNickname: (state) => {\r\n      return state.user?.nickname || 'ç”¨æˆ·'\r\n    },\r\n    \r\n    /**\r\n     * ç”¨æˆ·å¤´åƒ\r\n     */\r\n    userAvatar: (state) => {\r\n      return state.user?.avatar_url || '/static/uni.png'\r\n    },\r\n    \r\n    /**\r\n     * æ˜¯å¦æ˜¯ç®¡ç†å‘˜\r\n     */\r\n    isAdmin: (state) => {\r\n      return state.user?.role_id === 1\r\n    },\r\n    \r\n    /**\r\n     * ç”¨æˆ·è§’è‰²æ–‡æœ¬\r\n     */\r\n    userRoleText: (state) => {\r\n      if (!state.user) return 'æœªç™»å½•'\r\n      return state.user.role_id === 1 ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'\r\n    },\r\n    \r\n    /**\r\n     * ç™»å½•çŠ¶æ€æ–‡æœ¬\r\n     */\r\n    loginStatusText: (state) => {\r\n      if (state.loading.login) return 'ç™»å½•ä¸­...'\r\n      if (state.loading.refresh) return 'åˆ·æ–°ä¸­...'\r\n      if (!state.isLoggedIn) return 'æœªç™»å½•'\r\n      return 'å·²ç™»å½•'\r\n    },\r\n    \r\n    /**\r\n     * Tokenæ˜¯å¦å³å°†è¿‡æœŸ\r\n     */\r\n    tokenWillExpire: () => {\r\n      return TokenManager.shouldRefreshToken()\r\n    }\r\n  },\r\n  \r\n  actions: {\r\n    /**\r\n     * åˆå§‹åŒ–è®¤è¯çŠ¶æ€\r\n     * åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ï¼Œæ¢å¤æœ¬åœ°å­˜å‚¨çš„ç™»å½•çŠ¶æ€\r\n     */\r\n    async initAuthState() {\r\n      try {\r\n        console.log('ğŸš€ åˆå§‹åŒ–è®¤è¯çŠ¶æ€')\r\n        \r\n        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ç™»å½•çŠ¶æ€\r\n        const isLoggedIn = LoginStateManager.getLoginState()\r\n        const userInfo = UserManager.getUserInfo()\r\n        const hasToken = !!TokenManager.getAccessToken()\r\n        \r\n        if (isLoggedIn && userInfo && hasToken) {\r\n          // æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸ\r\n          if (TokenManager.isTokenExpired()) {\r\n            console.log('âš ï¸ Tokenå·²è¿‡æœŸï¼Œå°è¯•åˆ·æ–°')\r\n            await this.refreshToken()\r\n          } else {\r\n            // æ¢å¤ç™»å½•çŠ¶æ€\r\n            this.isLoggedIn = true\r\n            this.user = userInfo\r\n            this.updateTokenInfo()\r\n            console.log('âœ… ç™»å½•çŠ¶æ€å·²æ¢å¤', userInfo)\r\n          }\r\n        } else {\r\n          // æ¸…é™¤ä¸å®Œæ•´çš„çŠ¶æ€\r\n          this.clearAuthData()\r\n          \r\n          // æ£€æŸ¥å½“å‰é¡µé¢æ˜¯å¦ä¸ºç™»å½•é¡µé¢ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢\r\n          const pages = getCurrentPages()\r\n          if (pages.length > 0) {\r\n            const currentPage = pages[pages.length - 1]\r\n            const currentPath = `/${currentPage.route}`\r\n            \r\n            // å¦‚æœå½“å‰ä¸åœ¨ç™»å½•é¡µé¢ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢\r\n            if (currentPath !== '/pages/login/login') {\r\n              console.log('ğŸšª ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢')\r\n              uni.reLaunch({\r\n                url: '/pages/login/login'\r\n              })\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('âŒ åˆå§‹åŒ–è®¤è¯çŠ¶æ€å¤±è´¥:', error)\r\n        this.logout(false)\r\n      }\r\n    },\r\n    \r\n    /**\r\n     * å¾®ä¿¡å°ç¨‹åºç™»å½•\r\n     * @param {boolean} requireUserInfo - æ˜¯å¦éœ€è¦è·å–ç”¨æˆ·ä¿¡æ¯\r\n     * @param {boolean} isRetry - æ˜¯å¦ä¸ºé‡è¯•è°ƒç”¨\r\n     * @returns {Promise<boolean>} ç™»å½•æ˜¯å¦æˆåŠŸ\r\n     */\r\n    async loginWithWechat(requireUserInfo = false, isRetry = false) {\r\n      if (this.loading.login) {\r\n        throw new Error('æ­£åœ¨ç™»å½•ä¸­ï¼Œè¯·ç¨å€™...')\r\n      }\r\n      \r\n      try {\r\n        this.loading.login = true\r\n        console.log('ğŸ” å¼€å§‹å¾®ä¿¡ç™»å½•', { requireUserInfo, isRetry })\r\n        \r\n        // æ£€æŸ¥æ˜¯å¦æ”¯æŒå¾®ä¿¡ç™»å½•\r\n        if (!WechatAuth.isWechatLoginSupported()) {\r\n          throw new Error('å½“å‰ç¯å¢ƒä¸æ”¯æŒå¾®ä¿¡ç™»å½•')\r\n        }\r\n        \r\n        // è·å–å¾®ä¿¡ç™»å½•Codeï¼ˆé‡è¯•æ—¶å¼ºåˆ¶åˆ·æ–°ï¼‰\r\n        const code = await WechatAuth.getWechatCode(isRetry)\r\n        \r\n        console.log('ğŸ“ å‡†å¤‡ç™»å½•æ•°æ®', {\r\n          codePrefix: code.substring(0, 8) + '...',\r\n          requireUserInfo,\r\n          timestamp: new Date().toLocaleTimeString()\r\n        })\r\n        \r\n        // æ„å»ºç™»å½•è¯·æ±‚æ•°æ®\r\n        const loginData = { code }\r\n        \r\n        // å¦‚æœéœ€è¦ç”¨æˆ·ä¿¡æ¯ï¼Œè·å–ç”¨æˆ·æˆæƒ\r\n        if (requireUserInfo) {\r\n          try {\r\n            const userProfile = await WechatAuth.getUserProfile()\r\n            Object.assign(loginData, {\r\n              encryptedData: userProfile.encryptedData,\r\n              iv: userProfile.iv,\r\n              signature: userProfile.signature\r\n            })\r\n            console.log('ğŸ‘¤ å·²è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå‡†å¤‡å®Œæ•´ç™»å½•')\r\n          } catch (profileError) {\r\n            console.warn('âš ï¸ ç”¨æˆ·å–æ¶ˆæˆæƒï¼Œä»…è¿›è¡ŒåŸºç¡€ç™»å½•')\r\n          }\r\n        }\r\n        \r\n        // è°ƒç”¨ç™»å½•API\r\n        const response = await request.post(API_ENDPOINTS.AUTH.LOGIN, loginData, {\r\n          needAuth: false,\r\n          showLoading: false\r\n        })\r\n        \r\n        // ä¿å­˜è®¤è¯ä¿¡æ¯\r\n        this.saveAuthData(response)\r\n        \r\n        console.log('âœ… å¾®ä¿¡ç™»å½•æˆåŠŸ')\r\n        return true\r\n        \r\n      } catch (error) {\r\n        console.error('âŒ å¾®ä¿¡ç™»å½•å¤±è´¥:', error)\r\n        \r\n        // ç™»å½•å¤±è´¥æ—¶æ¸…é™¤codeç¼“å­˜\r\n        WechatAuth.clearCodeCache()\r\n        \r\n        // æ£€æŸ¥æ˜¯å¦ä¸ºcodeç›¸å…³é”™è¯¯\r\n        if (this.isCodeRelatedError(error)) {\r\n          console.log('ğŸ”„ æ£€æµ‹åˆ°codeç›¸å…³é”™è¯¯ï¼Œå‡†å¤‡é‡è¯•')\r\n          \r\n          // å¦‚æœä¸æ˜¯é‡è¯•è°ƒç”¨ä¸”é”™è¯¯ä¸codeç›¸å…³ï¼Œåˆ™å°è¯•é‡è¯•ä¸€æ¬¡\r\n          if (!isRetry) {\r\n            console.log('ğŸ”„ è‡ªåŠ¨é‡è¯•ç™»å½•ï¼ˆä½¿ç”¨æ–°codeï¼‰')\r\n            await this.delay(1000) // å»¶è¿Ÿ1ç§’åé‡è¯•\r\n            return await this.loginWithWechat(requireUserInfo, true)\r\n          }\r\n        }\r\n        \r\n        throw error\r\n      } finally {\r\n        this.loading.login = false\r\n      }\r\n    },\r\n    \r\n    /**\r\n     * æ£€æŸ¥æ˜¯å¦ä¸ºcodeç›¸å…³é”™è¯¯\r\n     * @param {Error} error - é”™è¯¯å¯¹è±¡\r\n     * @returns {boolean} æ˜¯å¦ä¸ºcodeç›¸å…³é”™è¯¯\r\n     */\r\n    isCodeRelatedError(error) {\r\n      const errorMsg = error.message?.toLowerCase() || ''\r\n      return errorMsg.includes('code') && \r\n             (errorMsg.includes('been used') || \r\n              errorMsg.includes('invalid') ||\r\n              errorMsg.includes('expired'))\r\n    },\r\n    \r\n    /**\r\n     * å»¶è¿Ÿå‡½æ•°\r\n     * @param {number} ms - å»¶è¿Ÿæ¯«ç§’æ•°\r\n     * @returns {Promise<void>}\r\n     */\r\n    delay(ms) {\r\n      return new Promise(resolve => setTimeout(resolve, ms))\r\n    },\r\n    \r\n    /**\r\n     * åˆ·æ–°Token\r\n     * @returns {Promise<void>}\r\n     */\r\n    async refreshToken() {\r\n      if (this.loading.refresh) {\r\n        return\r\n      }\r\n      \r\n      const refreshToken = TokenManager.getRefreshToken()\r\n      if (!refreshToken) {\r\n        throw new Error('æ²¡æœ‰åˆ·æ–°ä»¤ç‰Œï¼Œè¯·é‡æ–°ç™»å½•')\r\n      }\r\n      \r\n      try {\r\n        this.loading.refresh = true\r\n        console.log('ğŸ”„ åˆ·æ–°Token')\r\n        \r\n        const response = await request.post(API_ENDPOINTS.AUTH.REFRESH, {\r\n          refreshToken\r\n        }, {\r\n          needAuth: false,\r\n          showLoading: false\r\n        })\r\n        \r\n        // æ›´æ–°Tokenä¿¡æ¯\r\n        TokenManager.setTokens(response)\r\n        this.updateTokenInfo()\r\n        \r\n        console.log('âœ… Tokenåˆ·æ–°æˆåŠŸ')\r\n        \r\n      } catch (error) {\r\n        console.error('âŒ Tokenåˆ·æ–°å¤±è´¥:', error)\r\n        // åˆ·æ–°å¤±è´¥ï¼Œæ¸…é™¤ç™»å½•çŠ¶æ€\r\n        this.logout(false)\r\n        throw error\r\n      } finally {\r\n        this.loading.refresh = false\r\n      }\r\n    },\r\n    \r\n    /**\r\n     * è·å–ç”¨æˆ·èµ„æ–™\r\n     * @returns {Promise<void>}\r\n     */\r\n    async getUserProfile() {\r\n      if (!this.isAuthenticated) {\r\n        throw new Error('ç”¨æˆ·æœªç™»å½•')\r\n      }\r\n      \r\n      try {\r\n        this.loading.profile = true\r\n        console.log('ğŸ‘¤ è·å–ç”¨æˆ·èµ„æ–™')\r\n        \r\n        const userInfo = await request.get(API_ENDPOINTS.AUTH.PROFILE)\r\n        \r\n        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯\r\n        this.user = userInfo\r\n        UserManager.setUserInfo(userInfo)\r\n        \r\n        console.log('âœ… ç”¨æˆ·èµ„æ–™è·å–æˆåŠŸ')\r\n        \r\n      } catch (error) {\r\n        console.error('âŒ è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥:', error)\r\n        throw error\r\n      } finally {\r\n        this.loading.profile = false\r\n      }\r\n    },\r\n    \r\n    /**\r\n     * é€€å‡ºç™»å½•\r\n     * @param {boolean} callApi - æ˜¯å¦è°ƒç”¨ç™»å‡ºAPI\r\n     * @returns {Promise<void>}\r\n     */\r\n    async logout(callApi = true) {\r\n      try {\r\n        console.log('ğŸšª ç”¨æˆ·é€€å‡ºç™»å½•')\r\n        \r\n        // è°ƒç”¨ç™»å‡ºAPI\r\n        if (callApi && this.isAuthenticated) {\r\n          try {\r\n            await request.post(API_ENDPOINTS.AUTH.LOGOUT)\r\n          } catch (apiError) {\r\n            console.warn('âš ï¸ è°ƒç”¨ç™»å‡ºAPIå¤±è´¥ï¼Œç»§ç»­æœ¬åœ°ç™»å‡º', apiError)\r\n          }\r\n        }\r\n        \r\n        // æ¸…é™¤æ‰€æœ‰è®¤è¯ç›¸å…³æ•°æ®\r\n        this.clearAuthData()\r\n        \r\n        // è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼ˆå› ä¸ºç°åœ¨æ‰€æœ‰é¡µé¢éƒ½éœ€è¦ç™»å½•ï¼‰\r\n        uni.reLaunch({\r\n          url: '/pages/login/login'\r\n        })\r\n        \r\n        uni.showToast({\r\n          title: 'å·²é€€å‡ºç™»å½•',\r\n          icon: 'success'\r\n        })\r\n        \r\n      } catch (error) {\r\n        console.error('âŒ é€€å‡ºç™»å½•è¿‡ç¨‹å‡ºé”™:', error)\r\n      }\r\n    },\r\n    \r\n    /**\r\n     * æ£€æŸ¥ç™»å½•çŠ¶æ€\r\n     * @returns {boolean} æ˜¯å¦å·²ç™»å½•\r\n     */\r\n    checkAuthStatus() {\r\n      const hasToken = !!TokenManager.getAccessToken()\r\n      const isExpired = TokenManager.isTokenExpired()\r\n      const hasUser = !!this.user\r\n      const stateLoggedIn = this.isLoggedIn\r\n      \r\n      const actuallyLoggedIn = hasToken && !isExpired && hasUser && stateLoggedIn\r\n      \r\n      if (this.isLoggedIn !== actuallyLoggedIn) {\r\n        this.isLoggedIn = actuallyLoggedIn\r\n        if (!actuallyLoggedIn) {\r\n          this.clearAuthData()\r\n        }\r\n      }\r\n      \r\n      return actuallyLoggedIn\r\n    },\r\n    \r\n    /**\r\n     * ä¿å­˜è®¤è¯æ•°æ®\r\n     * @param {Object} authData - è®¤è¯æ•°æ®\r\n     * @param {string} authData.accessToken - è®¿é—®ä»¤ç‰Œ\r\n     * @param {string} authData.refreshToken - åˆ·æ–°ä»¤ç‰Œ\r\n     * @param {string} authData.expiresIn - è¿‡æœŸæ—¶é—´\r\n     * @param {Object} authData.user - ç”¨æˆ·ä¿¡æ¯\r\n     */\r\n    saveAuthData(authData) {\r\n      const { accessToken, refreshToken, expiresIn, user } = authData\r\n      \r\n      // ä¿å­˜Token\r\n      TokenManager.setTokens({\r\n        accessToken,\r\n        refreshToken,\r\n        expiresIn\r\n      })\r\n      \r\n      // ä¿å­˜ç”¨æˆ·ä¿¡æ¯\r\n      UserManager.setUserInfo(user)\r\n      \r\n      // ä¿å­˜ç™»å½•çŠ¶æ€\r\n      LoginStateManager.setLoginState(true)\r\n      \r\n      // æ›´æ–°StoreçŠ¶æ€\r\n      this.isLoggedIn = true\r\n      this.user = user\r\n      this.updateTokenInfo()\r\n      \r\n      console.log('ğŸ’¾ è®¤è¯æ•°æ®å·²ä¿å­˜')\r\n    },\r\n    \r\n    /**\r\n     * æ¸…é™¤è®¤è¯æ•°æ®\r\n     */\r\n    clearAuthData() {\r\n      // æ¸…é™¤Token\r\n      TokenManager.clearTokens()\r\n      \r\n      // æ¸…é™¤ç”¨æˆ·ä¿¡æ¯\r\n      UserManager.clearUserInfo()\r\n      \r\n      // æ¸…é™¤ç™»å½•çŠ¶æ€\r\n      LoginStateManager.clearLoginState()\r\n      \r\n      // é‡ç½®StoreçŠ¶æ€\r\n      this.isLoggedIn = false\r\n      this.user = null\r\n      this.tokenInfo = {\r\n        hasToken: false,\r\n        expiresAt: null\r\n      }\r\n      \r\n      console.log('ğŸ—‘ï¸ è®¤è¯æ•°æ®å·²æ¸…é™¤')\r\n    },\r\n    \r\n    /**\r\n     * æ›´æ–°Tokenä¿¡æ¯ï¼ˆç”¨äºUIæ˜¾ç¤ºï¼‰\r\n     */\r\n    updateTokenInfo() {\r\n      const hasToken = !!TokenManager.getAccessToken()\r\n      const expiresAt = uni.getStorageSync('token_expires_at')\r\n      \r\n      this.tokenInfo = {\r\n        hasToken,\r\n        expiresAt\r\n      }\r\n    },\r\n    \r\n    /**\r\n     * å¼ºåˆ¶åˆ·æ–°ç”¨æˆ·ä¿¡æ¯\r\n     */\r\n    async forceRefreshUser() {\r\n      if (!this.isAuthenticated) return\r\n      \r\n      try {\r\n        await this.getUserProfile()\r\n      } catch (error) {\r\n        console.warn('âš ï¸ å¼ºåˆ¶åˆ·æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)\r\n      }\r\n    }\r\n  }\r\n})\r\n"],"names":["defineStore","TokenManager","uni","LoginStateManager","UserManager","WechatAuth","request","API_ENDPOINTS"],"mappings":"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"}