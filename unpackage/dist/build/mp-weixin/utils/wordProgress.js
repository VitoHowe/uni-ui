"use strict";const e=require("../common/vendor.js"),t=e=>{if(!Array.isArray(e))return[];return Array.from(new Set(e.filter(Boolean)))},r=()=>(new Date).toISOString(),s=()=>({favorites:[],mistakes:[],mastered:[],lastCursor:0,updatedAt:r()}),a=e=>`WORD_PRACTICE_PROGRESS::${e}`;exports.createEmptyProgress=s,exports.persistBookProgress=(s,o)=>{if(!s)return;const i={favorites:t(o.favorites),mistakes:t(o.mistakes),mastered:t(o.mastered),lastCursor:o.lastCursor??0,updatedAt:r()};return e.index.setStorageSync(a(s),i),i},exports.readBookProgress=o=>{if(!o)return s();try{const s=e.index.getStorageSync(a(o))||{};return{favorites:t(s.favorites),mistakes:t(s.mistakes),mastered:t(s.mastered),lastCursor:Number.isInteger(s.lastCursor)?s.lastCursor:0,updatedAt:s.updatedAt||r()}}catch(i){return console.warn("读取单词进度失败",i),s()}},exports.updateCursor=(e,t)=>({...e,lastCursor:t}),exports.updateWordStatus=(e,r,s)=>{const a={favorites:t(e.favorites),mistakes:t(e.mistakes),mastered:t(e.mastered),lastCursor:e.lastCursor??0,updatedAt:e.updatedAt};var o;return o=r,a.favorites=a.favorites.filter((e=>e!==o)),a.mistakes=a.mistakes.filter((e=>e!==o)),a.mastered=a.mastered.filter((e=>e!==o)),"favorite"===s&&a.favorites.push(r),"mistake"===s&&a.mistakes.push(r),"mastered"===s&&a.mastered.push(r),{...a,favorites:t(a.favorites),mistakes:t(a.mistakes),mastered:t(a.mastered)}};
