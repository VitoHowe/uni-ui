"use strict";const e=require("../../../common/vendor.js"),a=require("../../../utils/request.js"),l=require("../../utils/subject.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const t={__name:"wrong-set",setup(t){const o=e.ref(l.SubjectStorage.get()),u=e.ref([]),n=e.ref(!1),r=e.ref(1),c=e.ref(!0),s=e.ref("all"),i=[{label:"全部",value:"all"},{label:"真题",value:"real"},{label:"模拟",value:"mock"},{label:"专项",value:"special"},{label:"随机",value:"random"}],v=async(e=!1)=>{var l;if((null==(l=o.value)?void 0:l.id)&&!n.value&&(c.value||e)){e&&(r.value=1,u.value=[],c.value=!0),n.value=!0;try{const l=await a.get("/practice/wrong-questions",(()=>{var e;const a={subjectId:(null==(e=o.value)?void 0:e.id)||0,page:r.value,limit:20};return"all"!==s.value&&(a.mode=s.value),a})(),{showLoading:!1}),t=l.items||[];u.value=e?t:u.value.concat(t);const i=l.total||0;c.value=u.value.length<i,r.value+=1}catch(t){console.error("获取错题集失败:",t)}finally{n.value=!1}}},d=async()=>{await v(!1)},g=e=>{if(!e)return"";const a=String(e).replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();return a.length>80?`${a.slice(0,80)}...`:a};return e.onShow((async()=>{(()=>{var e,a;const t=getCurrentPages(),u=t[t.length-1],n=null==(e=null==u?void 0:u.options)?void 0:e.subjectId,r=null==(a=null==u?void 0:u.options)?void 0:a.subjectName;n&&(o.value={id:Number(n),name:r?decodeURIComponent(r):`科目 ${n}`,code:null},l.SubjectStorage.set(o.value))})(),await v(!0)})),(l,t)=>{var r;return e.e({a:e.t((null==(r=o.value)?void 0:r.name)||"未选择科目"),b:e.f(i,((a,l,t)=>({a:e.t(a.label),b:a.value,c:s.value===a.value?1:"",d:e.o((e=>(async e=>{s.value!==e&&(s.value=e,await v(!0))})(a.value)),a.value)}))),c:n.value},n.value?{d:e.p({type:"spinner-cycle",size:"40",color:"#dc3545"})}:0===u.value.length?{f:e.p({type:"checkmarkempty",size:"80",color:"#ddd"})}:{g:e.f(u.value,((l,t,o)=>{return{a:e.t((n=l.mode,{real:"真题",mock:"模拟",special:"专项",random:"随机"}[n]||"未知")),b:e.t(l.source_name||"未知来源"),c:e.t(g(l.content)),d:e.t(l.wrong_times||0),e:e.t(l.correct_streak||0),f:e.o((t=>(l=>{e.index.showModal({title:"移除错题",content:"确定要移除此错题吗？",success:async t=>{if(t.confirm)try{await a.del(`/practice/wrong-questions/${l.id}`,{showLoading:!1}),u.value=u.value.filter((e=>e.id!==l.id))}catch(o){console.error("移除错题失败:",o),e.index.showToast({title:o.message||"移除失败",icon:"none"})}}})})(l)),l.id),g:l.id};var n}))},{e:0===u.value.length,h:c.value&&u.value.length>0},c.value&&u.value.length>0?{i:e.o(d)}:{})}}},o=e._export_sfc(t,[["__scopeId","data-v-20584900"]]);wx.createPage(o);
