"use strict";const e=require("../../../common/vendor.js"),t=require("../../../utils/request.js"),a=require("../../utils/subject.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const n={__name:"real-exam-list",setup(n){const o=e.ref([]),c=e.ref(!1),r=e.ref([]),l=e.ref(a.SubjectStorage.get()),u=e.ref(!1),s=e.ref({answered_count:0,correct_count:0,wrong_count:0,accuracy:0}),i=e=>{l.value=e,a.SubjectStorage.set(e)},d=()=>!!l.value||(e.index.showToast({title:"请先选择科目",icon:"none"}),!1),v=()=>{s.value={answered_count:0,correct_count:0,wrong_count:0,accuracy:0}},m=async()=>{if(d())try{const e=await t.get("/practice/summary",{subjectId:l.value.id,mode:"real"},{showLoading:!1});s.value=e.stats||{answered_count:0,correct_count:0,wrong_count:0,accuracy:0}}catch(e){console.error("获取练习统计失败:",e),v()}else v()},g=async()=>{if(d()){c.value=!0;try{const e=await t.get("/real-exams",{subjectId:l.value.id,page:1,limit:20});o.value=e.papers||[]}catch(a){console.error("获取真题失败:",a),e.index.showToast({title:a.message||"获取真题失败",icon:"none"})}finally{c.value=!1}}else o.value=[]},p=()=>{u.value||(r.value.length?e.index.showActionSheet({itemList:r.value.map((e=>e.name)),success:async e=>{const t=r.value[e.tapIndex];t&&(i(t),await m(),await g())}}):e.index.showToast({title:"暂无可选科目",icon:"none"}))};return e.onShow((async()=>{(()=>{var e,t;const a=getCurrentPages(),n=a[a.length-1],o=null==(e=null==n?void 0:n.options)?void 0:e.subjectId,c=null==(t=null==n?void 0:n.options)?void 0:t.subjectName;o&&i({id:Number(o),name:c?decodeURIComponent(c):`科目 ${o}`,code:null})})();const n=a.SubjectStorage.get();n&&(l.value=n),await(async()=>{if(!u.value){u.value=!0;try{const e=((await t.get("/subjects")).subjects||[]).map(a.normalizeSubject);if(r.value=e,!l.value&&e.length)return void i(e[0]);if(l.value){const t=e.find((e=>e.id===l.value.id));t?i(t):e.length&&i(e[0])}}catch(n){console.error("获取科目失败:",n),e.index.showToast({title:n.message||"获取科目失败",icon:"none"})}finally{u.value=!1}}})(),await m(),await g()})),(t,a)=>{var n;return e.e({a:e.t((null==(n=l.value)?void 0:n.name)||"请选择科目"),b:e.t(r.value.length?"切换":"加载中"),c:e.p({type:"arrowdown",size:"16",color:"#999"}),d:e.o(p),e:e.t(s.value.answered_count),f:e.t(s.value.accuracy),g:e.t(s.value.wrong_count),h:c.value},c.value?{i:e.p({type:"spinner-cycle",size:"40",color:"#3B82F6"})}:0===o.value.length?{k:e.p({type:"folder-add",size:"80",color:"#ddd"})}:{l:e.f(o.value,((t,a,n)=>{return e.e({a:e.t(t.name),b:e.t(t.total_questions||0),c:t.description},t.description?{d:e.t(t.description)}:{},{e:e.t((o=t.created_at,o?new Date(o).toLocaleDateString():"")),f:t.id,g:e.o((a=>(t=>{var a,n;const o=(null==(a=l.value)?void 0:a.id)||0,c=(null==(n=l.value)?void 0:n.name)||"",r=t.name||"";e.index.navigateTo({url:`/pkg-exam/pages/exam/exam?mode=real&paperId=${t.id}&subjectId=${o}&subjectName=${encodeURIComponent(c)}&paperName=${encodeURIComponent(r)}`})})(t)),t.id)});var o}))},{j:0===o.value.length})}}},o=e._export_sfc(n,[["__scopeId","data-v-c57036be"]]);wx.createPage(o);
