"use strict";const e=require("../../../common/vendor.js"),t=require("../../stores/upload.js"),o=require("../../../stores/auth.js"),n=require("../../../utils/auth.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-segmented-control")+e.resolveComponent("uni-section")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-progress")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list"))()}Math||((()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+i+(()=>"../../../uni_modules/uni-segmented-control/components/uni-segmented-control/uni-segmented-control.js")+(()=>"../../../uni_modules/uni-section/components/uni-section/uni-section.js")+(()=>"../../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../../uni_modules/uni-list/components/uni-list/uni-list.js")+s)();const s=()=>"../../../components/CustomTabBar.js",i=()=>"../../../components/AuthGuard.js",l={__name:"upload",setup(s){const i=t.useUploadStore(),l=o.useAuthStore(),u=e.computed((()=>i.config.fileTypeOptions)),a=e.computed((()=>i.currentFileType)),c=e.computed((()=>i.config.maxFileCount)),r=e.computed((()=>i.filesList)),p=e.computed((()=>i.uploadStatus.uploading)),d=e.computed((()=>i.uploadStatus.progress)),m=e.computed((()=>i.uploadHistory)),f=e.computed((()=>i.currentAllowedExtensions)),g=()=>i.currentFileTypeText,v=t=>{r.value.length>0?e.index.showModal({title:"切换文件类型",content:"切换文件类型将清空当前已选文件，是否继续？",success:e=>{e.confirm&&i.setFileType(t.currentIndex)}}):i.setFileType(t.currentIndex)},h=t=>{console.log("选择文件:",t);i.addFiles(t.tempFiles)&&e.index.showToast({title:`已选择 ${t.tempFiles.length} 个文件`,icon:"success"})},y=e=>{console.log("上传进度:",e)},x=e=>{console.log("上传成功:",e)},T=e=>{console.log("上传失败:",e)},k=()=>{0!==r.value.length&&e.index.showModal({title:"确认清空",content:"确定要清空所有已选文件吗？",success:t=>{t.confirm&&(i.clearFiles(),e.index.showToast({title:"已清空文件列表",icon:"success"}))}})},w=e=>i.getStatusColor(e),F=e=>({"成功":"success","失败":"failed","处理中":"processing"}[e]||"unknown"),C=async()=>{if((()=>{const t=n.PermissionChecker.checkFeatureAvailable("file_upload");return!!t.available||(e.index.showModal({title:"需要登录",content:t.message,confirmText:"立即登录",cancelText:"稍后再说",success:t=>{t.confirm&&(n.RouteGuard.saveReturnPath("/pkg-tools/pages/upload/upload"),e.index.navigateTo({url:"/pages/login/login"}))}}),!1)})())try{await i.startUpload()}catch(t){console.error("上传失败:",t),e.index.showToast({title:t.message||"上传失败",icon:"error"})}},j=e=>{console.log("切换到tab:",e)};return e.onMounted((()=>{console.log("文件上传页面加载"),l.isAuthenticated||e.index.showToast({title:"建议登录后使用完整上传功能",icon:"none",duration:3e3})})),(t,o)=>e.e({a:!e.unref(l).isAuthenticated},e.unref(l).isAuthenticated?e.e({f:e.o(v),g:e.p({values:u.value,current:a.value,styleType:"text",activeColor:"#007AFF"}),h:e.t(i.currentTypeDescription),i:e.p({title:"选择文件类型",type:"line",padding:!0}),j:e.p({type:"cloud-upload",size:"32",color:"#007AFF"}),k:e.t(g()),l:e.t(f.value.join(", ")),m:e.sr("filePickerRef","f666987f-7,f666987f-6"),n:e.o(h),o:e.o(y),p:e.o(x),q:e.o(T),r:e.o((e=>r.value=e)),s:e.p({"file-mediatype":"all","file-extname":f.value,limit:c.value,"auto-upload":!1,mode:"list",title:`已选择文件 (${r.value.length}/${c.value})`,modelValue:r.value}),t:e.p({title:"选择文件",type:"line",padding:!0}),v:r.value.length>0},r.value.length>0?e.e({w:p.value},p.value?{x:e.p({type:"spinner-cycle",size:"16",color:"#fff"})}:{},{y:e.t(p.value?"上传中...":"开始上传"),z:p.value,A:e.o(C),B:p.value,C:e.o(k)}):{},{D:d.value.show},d.value.show?{E:e.t(g()),F:e.t(d.value.current),G:e.t(d.value.total),H:e.p({percent:d.value.percent,"show-info":!0,color:"#007AFF","stroke-width":"8"}),I:e.p({title:"上传进度",type:"line",padding:!0})}:{},{J:m.value.length>0},m.value.length>0?{K:e.f(m.value,((t,o,n)=>{return{a:"f666987f-15-"+n+",f666987f-14-"+n,b:e.p({type:(s=t.status,i.getStatusIcon(s)),size:"18",color:w(t.status)}),c:e.n(`status-${F(t.status)}`),d:o,e:e.o((o=>(t=>{e.index.showModal({title:t.fileName,content:`文件类型：${t.fileType}\n上传时间：${t.uploadTime}\n文件大小：${t.fileSize}\n状态：${t.status}${t.errorMessage?"\n错误信息："+t.errorMessage:""}${t.recordCount?"\n解析记录数："+t.recordCount:""}`,confirmText:"确定"})})(t)),o),f:"f666987f-14-"+n+",f666987f-13",g:e.p({title:t.fileName,note:`${t.fileType} | ${t.uploadTime}`,rightText:t.status,clickable:!0})};var s}))}:{L:e.p({type:"inbox",size:"48",color:"#ccc"})},{M:e.p({title:"上传记录",type:"line",padding:!0}),N:e.o(j),O:e.p({current:4})}):{b:e.p({type:"checkmarkempty",size:"16",color:"#28a745"}),c:e.p({type:"checkmarkempty",size:"16",color:"#28a745"}),d:e.p({type:"checkmarkempty",size:"16",color:"#28a745"}),e:e.p({title:"文件上传",message:"登录后可上传PDF文件，系统将自动解析题库和知识点内容","show-preview":!0,"current-path":"/pkg-tools/pages/upload/upload"})})}},u=e._export_sfc(l,[["__scopeId","data-v-f666987f"]]);wx.createPage(u);
